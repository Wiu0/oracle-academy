import org.apache.http.HttpResponse;
import org.apache.http.client.HttpClient;
import org.apache.http.client.methods.HttpPost;
import org.apache.http.entity.StringEntity;
import org.apache.http.impl.client.HttpClientBuilder;
import org.json.JSONObject;

import br.com.maxicode.util.Funcoes;

public class Sender {

/*
 * {
  "to": "/topics/1/1/picker",
  "notification": {
    "title": "EASY",
    "body": "Novo pedido."
  },
  "data": {
    "payload": {
      "shoppingCartId": 5,
      "type": "CART_STATUS_CHANGED",
      "userId": "54",
      "status": "AVAILABLE_PICK"
    },
    "click_action": "FLUTTER_NOTIFICATION_CLICK"
  }
}*/
	
	public void send(long companyId, long cartId, long userId, String status) {
		String tokenUser = NoPrideButItWorks.tokenNo.get(companyId + ":" + userId + ":CUSTOMER");
		
		// Declaration of Message Parameters
	    String message_url = new String(Funcoes.getParametro("FCM.URL"));
	    String message_sender_id = tokenUser;
	    String message_key = new String("key=" + Funcoes.getParametro("FCM.URL"));

	    // Generating a JSONObject for the content of the message
	    JSONObject protocol = new JSONObject();
	    protocol.put("to", message_sender_id);
	    JSONObject notifi = new JSONObject();
	    notifi.put("title", "EASY");
	    notifi.put("body", "Seu pedido saiu para entrega");
	    protocol.put("notification", notifi);
	    
	    JSONObject pay = new JSONObject();
	    pay.put("shoppingCartId", cartId);
	    pay.put("type", "CART_STATUS_CHANGED");
	    pay.put("userId", userId);
	    pay.append("status", status);
	    protocol.put("data", pay);
	    protocol.put("click_action", "FLUTTER_NOTIFICATION_CLICK");

	    // Send Protocol
	    try {
	        HttpClient httpClient = HttpClientBuilder.create().build();

	        HttpPost request = new HttpPost(message_url);
	        request.addHeader("content-type", "application/json");
	        request.addHeader("Authorization", message_key);

	        StringEntity params = new StringEntity(protocol.toString());
	        request.setEntity(params);
	        System.out.println(params);

	        HttpResponse response = httpClient.execute(request);
	        System.out.println(response.toString());
	    } catch (Exception e) {
	    }
	}
}
